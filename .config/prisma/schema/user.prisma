enum Role {
  SUPERADMIN   
  ADMIN
  FAP
  MASTER_AGENT
  TL
  LOADER
  ACCOUNTING 
  SSMA   
}

// SuperAdmin: the alpha entity, connected to a User
model SuperAdmin {
  id          String        @id @default(uuid())
  name        String
  location    String?
  ownerId     String   @unique // Unique means only one SuperAdmin per User
  owner       User     @relation(fields: [ownerId], references: [id])
  casinoGroups CasinoGroup[] // NEW: one superadmin has many casino groups
  createdAt   DateTime      @default(now())
}

// Unified User: single model for all roles
model User {
  id               String          @id @default(uuid())
  email            String?          @unique
  password         String
  name             String
  username         String         @unique
  role             Role
  messengerLink    String?
  active           Boolean         @default(true)
  isClockedIn      Boolean         @default(false) 
  attendances      Attendance[]    // history

  remarks          String?        // additional remarks or notes
  groupChats       GroupChat[]

  referredBy       User?           @relation("UserReferrals", fields: [referredById], references: [id])
  referredById     String?
  referrals        User[]          @relation("UserReferrals")

  cashinThreads   CashinThread[]
  mentionedInCashinThreads CashinThread[] @relation("CashinThreadMentions")
  cashins         Cashin[]
  cashinLogs      CashinLogs[]

  cashoutThreads   CashoutThread[]
  mentionedInThreads CashoutThread[] @relation("CashoutThreadMentions")
  cashouts         Cashout[]
  cashoutLogs      CashoutLogs[]

  remittance         Remittance[]         @relation("RemittanceCreator")
  taggedRemittance   Remittance[]         @relation("RemittanceTags") // tagged in remittances
  remittanceThreads   RemittanceThread[]
  mentionedInRemittanceThreads RemittanceThread[] @relation("RemittanceThreadMentions")
  remittanceLogs      RemittanceLogs[]

  concerns         Concern[]         @relation("ConcernCreator")
  taggedConcerns   Concern[]         @relation("ConcernTags") // tagged in concerns
  concernThreads   ConcernThread[]
  mentionedInConcernThreads ConcernThread[] @relation("ConcernThreadMentions")
  concernLogs      ConcernLogs[]

  customerSupports         CustomerSupport[]         @relation("CustomerSupportCreator")
  taggedCustomerSupports   CustomerSupport[]         @relation("CustomerSupportTags") // tagged in customer supports
  customerSupportThreads   CustomerSupportThread[]
  mentionedInCustomerSupportThreads CustomerSupportThread[] @relation("CustomerSupportThreadMentions")
  customerSupportLogs      CustomerSupportLogs[]
  
  tasks         Task[]         @relation("TaskCreator")
  taggedTasks   Task[]         @relation("TaskTags") // tagged in tasks
  taskThreads   TaskThread[]
  mentionedInTaskThreads TaskThread[] @relation("TaskThreadMentions")
  taskLogs      TaskLogs[]

  commissionThreads   CommissionThread[]
  commisionLogs     CommissionLogs[]
  mentionedInCommissionThreads CommissionThread[] @relation("CommissionThreadMentions")

  transactionRequests TransactionRequest[]

  superAdmin       SuperAdmin? // one-to-one: nullable if not all users are superadmins
  casinoGroups     CasinoGroup[] // Many-to-many relationship with CasinoGroup



  // Ready-check relations
  initiatedReadyChecks  ReadyCheck[]               @relation("ReadyCheckInitiator")
  readyCheckParticipants ReadyCheckParticipant[]

  notifications  Notifications[]
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  
  balance        Float        @default(10000) // User's current balance
}

model Attendance {
  id         String   @id @default(uuid())
  user       User     @relation(fields: [userId], references: [id])
  userId     String
  time       DateTime @default(now())
  particular String   // Clock-in or Clock-out
  active     Boolean  @default(true) // true between clock-in and clock-out
  context    String?                  // optional: "casinoGroup:<id>" or "shift"

  // IP address of the device that performed the clock-in / clock-out.
  ipAddress  String?  

  // Device or short device description (best-effort from User-Agent)
  device     String?  

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([userId, active])
  @@index([ipAddress])
}

model ReadyCheck {
  id                String                   @id @default(uuid())
  initiator         User                     @relation("ReadyCheckInitiator", fields: [initiatorId], references: [id])
  initiatorId       String
  context           String?                  // optional metadata (e.g. "casinoGroup:<id>")
  startedAt         DateTime                 @default(now())
  endedAt           DateTime?
  totalParticipants Int                      @default(0) // snapshot of number invited
  totalClockedIn    Int                      @default(0) // snapshot of how many were clocked in at start
  participants      ReadyCheckParticipant[]  // participant rows (responses + snapshots)
  createdAt         DateTime                 @default(now())
  updatedAt         DateTime                 @updatedAt

  @@index([initiatorId])
  @@index([startedAt])
}

model ReadyCheckParticipant {
  id             String     @id @default(uuid())
  readyCheck     ReadyCheck @relation(fields: [readyCheckId], references: [id])
  readyCheckId   String
  user           User       @relation(fields: [userId], references: [id])
  userId         String

  // Snapshot whether the user was clocked in at the moment the ready-check started
  wasClockedIn   Boolean    @default(false)

  // Whether the user clicked "ready" for this ready-check
  responded      Boolean    @default(false)
  respondedAt    DateTime?

  // Optional denormalized snapshots for reporting
  username       String?
  role           Role?

  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  @@unique([readyCheckId, userId])
  @@index([userId])
  @@index([responded])
}